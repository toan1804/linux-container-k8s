### Docker

##### Dockerfile

> A `Dockerfile` is a text document that contains all the commands a user could call on the command line to assemble an image.

##### Docker image

> A `Docker container image` is a lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries and settings.

**You can pull an image from Docker hub:**

```bash
docker pull <image_name>
```

*e.g.* `docker pull debian`. This command will pull an image from Docker hub that named `debian`.

**Or, you can create a custom image with `dockerfile`:**

```bash
docker build <path/to/dockerfile> -t <image_name>:<version>
```

*e.g.* `docker build . -t node:latest`

**Also, you can search image from Docker hub:****

```bash
docker search <image_name>
```

**Manage Docker image in your machine:**

```bash
docker images
```

or

```bash
docker image ls
```

**Remove an image in your machine:**

```bash
docker image rm <image_name|image_id>
```

*e.g.* `docker image rm test`

##### Container

> A `container` is a standard unit of software that packages up code and all its dependencies so the application runs quickly and reliably from one computing environment to another.

**Run `container` from docker image:**

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

*e.g.* `docker run -d -p 8000:8000 --name debian-test <image_name|image_id>`

*explaine:* `-d`: for deamon, `-p` for expose port

**Print  docker container is running:**

```bash
docker ps
```

or

```bash
docker container ls
```

**Print all docker container:**

```bash
docker ps -a
```

or

```bash
docker container ls -a
```

**Stop a container:**

```bash
docker stop [OPTIONS] CONTAINER [CONTAINER...]
```

*e.g.* `docker stop debian`

**Start a container:**

```bash
docker start [OPTIONS] CONTAINER [CONTAINER...]
```

*e.g.* `docker start debian`

**Enter the bash/cli in container:**

```bash
docker exec -it <container_name|container_id> bash
```

**Remove a docker container:**

```bash
docker container rm <container_name|container_id>
```

or

```bash
docker rm <container_name|container_id>
```

##### Docker Volumes

> Volumes are the preferred mechanism for persisting data generated by and used by Docker containers.

**Create a `volumes`:**

```bash
docker volume create [OPTIONS] [VOLUME]
```

*e.g.* `docker volume create my_vl`

**Print your volumes:**

```bash
docker volume ls
```

**Inspect Volume:**

```bash
docker volume inspect [volume_name]
```

*e.g.* `docker volume inspect my_vl`

<img src="images/docker_inspect_volume.png" title="" alt="a" data-align="center">

**Remove volumes:**

```bash
docker volume rm [volume_name]
```

or remove all volumes not used by any container:

```bash
docker volume prune
```

**Create a container with volumes:**

There are two ways to mount a volume with container:

1. Use flag `--volume` or `-v` for short:
   
   ```bash
   docker run --name [container_name] --volume "[volume_name]":[/path/in/container] [docker_image]
   ```

*e.g.* `docker run -d -it --name node_c --volume "my_vl":/tmp node`

2. Use flag `--mount`:
   
   ```bash
   docker run --mount source=[volume_name],destination=[path_in_container] [docker_image]
   ```

*e.g.* `docker run -d -it --name node_c --mount source=my_vl,target=/tmp node`

**Use *ReadOnlyVolumes***:

By default, all `container` have read and write permission with `volume`, but if you only allow read permission, you can:

```bash
docker run --name [container_name] --volume "[volume_name]":[/path/in/container]:ro [docker_image]
```

*e.g.* `docker run --name node_c --volume "my_vl":/tmp:ro node`

or

```bash
docker run --mount source=[volume_name],destination=[path_in_container],ro [docker_image]
```

*e.g.* `docker run -d -it --name node_c --mount source=my_vl,target=/tmp,ro node`

**Volume with `Docker Compose`:**

You can mount volume with container inside `docker-compose.yaml`:

```yaml
version: "3.9"
services:
  frontend:
    image: node:lts
    volumes:
      - myapp:/home/node/app
volumes:
  myapp:
```

When you run `docker-compose up`, the volume will be created.

A volume may be created directly outside of compose with `docker volume create` and then referenced inside `docker-compose.yml` as follows: 

```yaml
version: "3.9"
services:
  frontend:
    image: node:lts
    volumes:
      - myapp:/home/node/app
volumes:
  myapp:
    external: true
```
